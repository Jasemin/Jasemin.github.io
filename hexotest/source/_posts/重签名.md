---
title: iOS的ipa包重签名
categories: 
    - 逆向工程
tags: 
    - iOS
---
逆向，顾名思义就是将别人打包出来的软件包逆转回去，在这里我们将带领大家操作如何将砸壳的ipa包进行逆向，至于如何取到ipa包和如何砸壳就不在这里说明了，以后会单独写出文档来。

<!--more-->

# 重签名
查看软件签名信息：

```
Payload duoyi$ codesign -d QiYiPadVideo.app
Payload duoyi$ codesign -d -vv QiYiPadVideo.app/QiYiPadVideo
```
签名信息:

```
Authority=Apple iPhone OS Application Signing
Authority=Apple iPhone Certification Authority
Authority=Apple Root CA
```
查看电脑里的可用签名信息：
```
security find-identity -v -p codesigning
```
## 查看应用是否加密
- cd QiYiPadVideo.app/
- QiYiPadVideo.app duoyi$ ls -l QiYiPadVideo
- otool -l QiYiPadVideo > ~/Desktop/123.txt
- 搜索字段“cryptid”：0没有加密，1代表某种加密方式
- 筛选出cryptid：otool -l QiYiPadVideo | grep cryptid

## 重签名操作
- 删除PlugIns及watch目录下的PlugIns
- 签名framework：codesign -fs "Apple Development: 615656404@qq.com (GLT92A3Y9W)" ZipArchive.framework
- （稍微注意：有的可执行文件是没有执行权限的！需要给执行权限）
- 修改info.plist文件中的bundle ID
- 拷贝描述文件
- 查看描述文件：
```
jingtengzhoudeMacBook-Pro:Frameworks jasemin$ cd ..
jingtengzhoudeMacBook-Pro:DuoYiIM.app jasemin$ security cms -D -i embedded.mobileprovision 
```
- 生成权限文件：
```
<key>Entitlements</key>
	<dict>
				
				<key>application-identifier</key>
		<string>WZQ2ZJ2QA8.jasemin.Machismo</string>
				
				<key>keychain-access-groups</key>
		<array>
				<string>WZQ2ZJ2QA8.*</string>
		</array>
				
				<key>get-task-allow</key>
		<true/>
				
				<key>com.apple.developer.team-identifier</key>
		<string>WZQ2ZJ2QA8</string>

	</dict>
```
- 进行重签名：
```
jingtengzhoudeMacBook-Pro:Payload jasemin$ codesign -fs "iPhone Developer: 615656404@qq.com (GLT92A3Y9W)" --no-strict --entitlements=/Users/jasemin/Desktop/火星_3.4.5.01/Payload/\ entitlements.plist DuoYiIM.app/
```
- 打包生成ipa文件：
```
jingtengzhoudeMacBook-Pro:Payload jasemin$ cd ..
jingtengzhoudeMacBook-Pro:火星_3.4.5.01 jasemin$ ls
Container		Payload			iTunesArtwork		iTunesMetadata.plist
jingtengzhoudeMacBook-Pro:火星_3.4.5.01 jasemin$ zip -ry DuoYiIM.ipa Payload/
```
